<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Кто я в мире Шрека</title>
    <link rel="shortcut icon" href="img/Puss3icon.ico" type="image/x-icon">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="main">
        <!-- ОСНОВНОЙ ЭКРАН -->
        <div class="app" v-show = "showMain"> <!-- директива v-show значение которой мы берем из скрипта и отвечает за то, какой экран будет показываться --> <!-- директива @click - срабатывает при нажатии кнопки -->
            <div class="app__header">
                <img src="./img/logo.png" alt="" class="app__logo">
            </div>
            <div class="app__main-part">
                <button class="app__btn" @click="goToQuestion">
                    <i class="fa fa-play-circle-o" area-hidden = "true"></i>
                    <div class="app__btn-text">Начать</div>
                </button>
                <button class="app__btn" @click="goToAchivment"> 
                    <i class="fa fa-trophy" area-hidden = "true"></i>
                    <div class="app__btn-text">Достижения</div>
                </button>
                <button class="app__btn" @click="goToSocial">
                    <i class="fa fa-user" area-hidden = "true"></i>
                    <div class="app__btn-text">Автор</div>
                </button>
                <button class="app__btn btn__sound">
                    <i class="fa fa-volume-up" area-hidden = "true"></i>
                    <div class="app__btn-text">Звук</div>
                </button>
            </div>
        </div>

        <!-- ЭКРАН С ДОСТИЖЕНИЯМИ -->
         <div class="app achivments" v-show = "showAchivment">
            <div class="app__main-part">
                <div class="app__body-inner">
                    <h2 class="app__body-title"><i class="fa fa-trophy" area-hidden = "true"></i>
                        Достижения
                    </h2>
                    <div class="app__body-top">
                        <div class="app__card">
                            <div class="app__card-text">Счёт</div>
                            <div class="app__card-count">{{totalScore}}</div>
                        </div>
                        <div class="app__card">
                            <div class="app__card-text">Всего игр</div>
                            <div class="app__card-count">{{totalGames}}</div>
                        </div>
                        <div class="app__card">
                            <div class="app__card-text">Открыто персонажей</div>
                            <div class="app__card-count">{{openCharacters}}</div>
                        </div>
                        <div class="app__card">
                            <div class="app__card-text">Любимый персонаж</div>
                            <div class="app__card-count">{{favCharacter}}</div>
                        </div>
                    </div>
                    <div class="app__body-middle">
                        <div class="app__result" 
                            v-for="(race, k) in results"
                            v-show="showResultRace[k]"
                            @click="goToResults(k)">
                            <div class="app__result-score">
                                <i class="fa fa-star" area-hidden = "true"></i>
                                <div class="app__result-count">{{race.points}}</div>
                            </div>
                            <div class="app__result-name">{{race.name}}</div>
                            <div class="app__result-amount">{{totalGame[k]}}</div>
                        </div>
                    </div>
                    <div class="app__body-bottom">
                        <button class="app__btn btn__back btn__achivment" @click="goToMain">
                            <i class="fa fa-reply" area-hidden = "true"></i>
                        </button>
                    </div>
                </div>
            </div>
         </div>

         <!-- ЭКРАН С ВОПРОСАМИ -->
          <div class="app" v-show = "showQuestions">
            <div class="app__header">
                <div class="app__header-inner">
                    <div class="app__count"># {{number + 1}}</div>
                    <div class="app__text">{{questions[number][0]}}</div>
                </div>
            </div>
            <div class="app__main-part">
                <button class="app__btn answer-btn"
                v-for="(answer, i) in questions[number][1]"
                v-on:click="nextQuestions(questions[number][2][i])"> <!-- устанавливаем индекс 2 так как в файле const.js в нашем массиве под вторым индексом хранится код для вычисления какой ответ характеризует какого персонажа -->
                    <div class="app__btn-text">{{answer}}</div>
                </button>
            </div>
          </div>

          <!-- ЭКРАН С СОЦСЕТЯМИ -->
           <div class="app" v-show = "showSocial">
            <div class="app__main-part">
                <a href="https://vk.com/inheen" class="app__btn" target="_blank">
                    <i class="fa fa-vk" area-hidden = "true"></i>
                    <div class="app__btn-text">ВКонтакте</div>
                </a>
                <a href="https://t.me/inheeeen" class="app__btn" target="_blank">
                    <i class="fa fa-telegram" area-hidden = "true"></i>
                    <div class="app__btn-text">Telegram</div>
                </a>
                <a href="https://www.instagram.com/_inhen_?igsh=MW9hY2VlazZzNDhkeg%3D%3D&utm_source=qr" class="app__btn" target="_blank">
                    <i class="fa fa-instagram" area-hidden = "true"></i>
                    <div class="app__btn-text">instagram</div>
                </a>
                <div class="app__body-bottom">
                    <button class="app__btn btn__back" @click="goToMain">
                        <i class="fa fa-reply" area-hidden = "true"></i>
                    </button>
                </div>
            </div>
           </div>

        <!-- ЭКРАН С РЕЗУЛЬТАТМИ -->
         <div class="app results" v-bind:data-race="resultRace" v-show = "showResults">
            <div class="app__main-part">
                <div class="app__results-inner">
                    <div class="results__title">{{ results[resultRace].name}}</div>
                    <div class="results__img">
                        <img :src="'./img/'+resultRace+'.jpg'" class="results__img-img">
                    </div>
                    <div class="results__text-box">
                        <p class="results__text">{{ results[resultRace].description}}</p>
                        <p class="results__quote">{{ results[resultRace].quote1}}</p>
                        <p class="results__quote">{{ results[resultRace].quote2}}</p>
                    </div>
                    <div class="">
                        <button :class="'app__btn btn__back btn__'+resultRace" @click="goToAchivment">
                            <i class="fa fa-reply" area-hidden = "true"></i>
                        </button>
                    </div>
                </div>
            </div>
         </div>
    </div>

    <script src="js/vue.js"></script>
    <script src="js/const.js"></script>

    <!-- наш код на Vue.js -->
    <script>
        //создаем переменную и инициализируем в ней работу Vue(внутри скобок передаем обьект {} в котором будут храниться все параметры для Vue)
        let app = new Vue({
            el: '.main',//элемент - указываем селектор, который будет являться главным элементом ( в нашем случае это будет div с классом main)
            data: /* тут создадим логические переменные с помощью которых сможем отображать наши экраны (так как showMain в значении true - то по умолчанию будет отображаться главный экран, а экран с соц. сетями(showSocial) будет скрыт)*/{
                showMain: true, 
                showSocial: false,
                showAchivment: false,
                showQuestions: false,
                showResults: false,
                number: 0, //переменная, отвечающая за номер вопроса
                score: {
                    'shrek': 0,
                    'fiona':0,
                    'prynia':0,
                    'osel':0,
                    'cat':0,
                    'lord':0,
                    'drakon':0,
                },
                totalGame /* колво игр за каждого персонажа которое будет отображаться на странице с достижениями */: localStorage.getItem('sc2TotalGame') ? JSON.parse /* если в локальном хранилище хранятся какие-то из нужных нам данных, то таким образом мы это сможем выявить */(localStorage.getItem('sc2TotalGame')) : {
                    'shrek': 0,
                    'fiona':0,
                    'prynia':0,
                    'osel':0,
                    'cat':0,
                    'lord':0,
                    'drakon':0,
                },
                totalGames /* общее колво сыгранных игр */: localStorage.getItem('sc2TotalGames') ? localStorage.getItem('sc2TotalGames') : 0,//если в локальном хранилище нет заданной переменной, то будет устанавливаться 0, если же есть, то с помощью getItem будем отображать это число
                questions: questions, /* взяли константу question из файлы const.js и так как у нас подключен файл const.js то никаких проблем не будет и константа будет найдена */
                results: results, /* константа из файла const.js */
                resultRace: 'shrek',
            }, //передаем тут любые данные
            /* МЕТОДЫ - ФУНКЦИИ */
            methods: {
                /* метод, который будет перенаправлять нас на главную страницу с любой другой (кнопка назад)*/
                goToMain() {
                    this.showMain = true // this - указывает что переменная после точки является переменной внутри нашего элемента
                    this.showSocial = false //отключаем отображение всех страниц кроме Main
                    this.showAchivment = false
                    this.showQuestions = false
                    this.showResults = false
                },

                /* метод, который будет перенаправлять нас на страницу соц.сетей*/
                goToSocial() {
                    this.showMain = false
                    this.showSocial = true
                    this.showAchivment = false
                    this.showQuestions = false
                    this.showResults = false
                },

                /* метод, который будет перенаправлять нас на страницу достижений, но только в том случае если уже была сыграна хоть 1 игра*/
                goToAchivment() {
                    if(this.totalGames > 0) {
                        this.showMain = false
                        this.showSocial = false
                        this.showAchivment = true
                        this.showQuestions = false
                        this.showResults = false
                    } else {
                        this.goToQuestion() //вызываем метод, который будет направлять на страницу с вопросами
                    }
                },

                /* метод, который будет направлять на страницу с вопросами */
                goToQuestion(){
                    /* сброс всех переменных к 0 в начале каждой игры */
                    this.score = {
                        'shrek': 0,
                        'fiona':0,
                        'prynia':0,
                        'osel':0,
                        'cat':0,
                        'lord':0,
                        'drakon':0,
                    },
                    this.showMain = false
                    this.showSocial = false
                    this.showAchivment = false
                    this.showQuestions = true
                    this.showResults = false
                },

                /* метод, который будет направлять на страницу с результатами и отображать его*/
                goToResults(race) {
                    this.showMain = false
                    this.showSocial = false
                    this.showAchivment = false
                    this.showQuestions = false
                    this.showResults = true
                    this.resultRace = race

                    if (race === 'none'){
                        this.resultText = "Вы не похожи ни на кого из вселенной Шрека :(("
                    } else {
                        this.resultText = `Вы - ${result}`
                    }
                },

                /* метод для переключения вопроса */
                nextQuestions(answer) {
                    if(this.number == 6) /* если индекс вопроса = 6(последний вопрос), то мы значение вопроса сбрасываем до 0 чтобы новая игра началась с первого вопроса */{
                        this.number = 0
                        this.endGame()
                    } else /* если вопрос не последний, то будет выполняться переключение на следующий вопрос */ {
                        this.number++ //увеличиваем значение вопроса на 1
                    }
                    eval(answer) //выполняется код из файлы const.js с подсчетом очков за каждого персонажа
                },

                /* метод для расчета результата игры и того финала, на который выходит игрок */
                endGame () {
                    this.totalGames++;
                    localStorage.setItem('sc2TotalGames', this.totalGames)
                    
                    //определяем максимальное колво очков
                    let maxScore = Math.max (
                        this.score.shrek, this.score.osel, this.score.lord, this.score.fiona, this.score.cat, this.score.drakon, this.score.prynia
                    );

                    //фильтруем персонажей и находим у кого максимум очков
                    let possibleResults = Object.keys(this.score).filter(
                        key => this.score[key] >= 4 && this.score[key] === maxScore
                    );

                    //выбираем случайного персонажа если у кого-то равное колво баллов
                    if ( possibleResults.length > 0) {
                        let randomResult = possibleResults[Math.floor(Math.random()* possibleResults.length)]
                        this.goToResults(randomResult)
                        this.totalGame[randomResult]++
                    } else {
                        this.goToResults('none')
                    }
                    localStorage.setItem('sc2TotalGame', JSON.stringify(this.totalGame))
                    } 
                },

                /* СВОЙСТВА - вычисляются только в том случае, если происходит изменение в одном из свойств, создается так же как метод, но обязательно должно возвращать хотя бы 1 значение*/

                computed: {

                    /* общий счет игры */
                    totalScore() {
                        let score = 0 
                        for (let i in this.totalGame) {
                            score += (this.totalGame[i]*results[i].points)
                        }
                        return score
                    },

                    /* проверка открытых персонажей */
                    openCharacters() {
                        let count = 0 
                        for (let i in this.totalGame) {
                            if(this.totalGame[i]>0) count++
                        }
                        return count
                    },

                    /* любимый персонаж */
                    favCharacter() {
                        let max = 'fiona'
                        for (let i in this.totalGame) {
                            if (this.totalGame[i]>this.totalGame[max]) {
                                max = i
                            }
                        }
                        return results[max].name
                    },

                    /* если персонаж еще ни разу не попадался то он не будет отображаться в достижениях */
                    showResultRace() {
                        return {
                            'shrek': this.totalGame.shrek > 0 ? true : false,
                            'fiona': this.totalGame.fiona > 0 ? true : false,
                            'cat': this.totalGame.cat > 0 ? true : false,
                            'osel': this.totalGame.osel > 0 ? true : false,
                            'lord': this.totalGame.lord > 0 ? true : false,
                            'drakon': this.totalGame.drakon > 0 ? true : false,
                            'prynia': this.totalGame.prynia > 0 ? true : false,

                        }
                    }

                }

            })

    </script>
</body>
</html>